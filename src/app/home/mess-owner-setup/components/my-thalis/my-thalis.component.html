<!-- my-thalis.component.html -->
<div class="container">
  <div class="header-row">
      <h1 class="my-thalis-heading" *ngIf="!(editingState.isEditing$ | async)">My Thalis</h1>

  </div>
  <!-- Edit Form (shown when editing) -->
  <div *ngIf="editingState.isEditing$ | async" class="edit-form-container">
    <app-add-thali [thaliData]="selectedThali" (thaliCreated)="onThaliCreated($event)" (thaliUpdated)="onThaliUpdated()"
      (cancelEdit)="onCancelEdit()">
    </app-add-thali>
  </div>

  <div *ngIf="!(editingState.isEditing$ | async)" class="content-wrapper">
    <div class="filters-container">
      <div class="filter-group">
        <label for="nameFilter">Search by Name:</label>
        <input id="nameFilter" type="text" [(ngModel)]="filterName" placeholder="Enter thali name..."
          (input)="onNameFilterInput($event)" />
      </div>

      <div class="filter-group">
        <label for="statusFilter">Status:</label>
        <select id="statusFilter" [(ngModel)]="filterStatus" (change)="onStatusFilterChange($event)">
          <option value="all">All</option>
          <option value="published">Published</option>
          <option value="unpublished">Unpublished</option>
        </select>
      </div>

      <!-- Custom Date Filter Only -->
      <div class="filter-group">
        <label for="dateFilter">Filter by Date:</label>
        <input id="dateFilter" type="date" [(ngModel)]="selectedDate" (change)="applyDateFilter()" />
      </div>

      <div class="refresh-wrapper">
      <button class="refresh-btn" (click)="refreshThalis()" [disabled]="loading">

        <svg class="refresh-icon" [class.spinning]="loading" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2">

          <polyline points="23 4 23 10 17 10"></polyline>
          <polyline points="1 20 1 14 7 14"></polyline>
          <path d="m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>

        {{ loading ? 'Refreshing...' : 'Refresh' }}

      </button>
    </div>
    </div>
    <!-- Thali List (shown when not editing) -->
    <div class="thali-list-container">
      <!-- Display current filter info -->
      <div class="filter-info" *ngIf="selectedDate">
        <span class="filter-badge">
          Showing thalis for: {{selectedDate | date:'mediumDate'}}
          <button class="clear-filter" (click)="clearDateFilter()">×</button>
        </span>
      </div>
      <div *ngIf="loading" class="loading-container">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading thalis...</p>
      </div>

      <div *ngIf="error && !loading" class="error-container">
        <p>{{ error }}</p>
        <button class="retry-btn" (click)="refreshThalis()">Try Again</button>
      </div>


      <div class="thali-list" *ngIf="!loading && !error">
        <div class="thali-card" *ngFor="let thali of filteredThalis">
          <!-- Your existing thali card content -->
          <div class="thali-image">
            <img [src]="thali.image" alt="{{ thali.thaliName }}">
          </div>
          <div class="thali-details">
            <h3>{{ thali.thaliName }}</h3>
            <div class="thali-meta">
              <span class="thali-type">{{ thali.type | titlecase }}</span>
              <span class="thali-price">₹{{ thali.price }}</span>
              <span class="thali-date" *ngIf="thali.available_date">
                {{ thali.available_date | date:'mediumDate' }}
              </span>
            </div>
            <div class="thali-time">
              From <strong>{{ thali.timeFrom }}</strong> To <strong>{{ thali.timeTo }}</strong>
            </div>
            <div class="thali-items">
              <p><strong>Sabzi:</strong> {{ thali.sabzi }}</p>
              <p><strong>Daal:</strong> {{ thali.daal ? 'Yes' : 'No' }}</p>
              <p *ngIf="thali.sweet"><strong>Sweet:</strong> {{ thali.sweetInfo.trim() || 'Not specified' }}</p>
            </div>
          </div>
          <div class="thali-actions">
            <button class="publish-btn" [class.unpublish]="thali.published" (click)="togglePublish(thali)">
              {{ thali.published ? 'Unpublish' : 'Publish' }}
            </button>
            <button class="edit-btn" (click)="editThali(thali)">Edit</button>
            <button class="delete-btn" (click)="deleteThali(thali)">Delete</button>
          </div>
        </div>

        <!-- No results message -->
        <div class="no-results" *ngIf="filteredThalis.length === 0">
          <p>No thalis found matching your filters.</p>
          <button class="clear-all-filters" (click)="clearAllFilters()">
            Clear all filters
          </button>
        </div>
      </div>

      <!-- Floating Action Button -->
      <button class="add-thali-btn" (click)="addNewThali()" aria-label="Add new thali">
        <span class="plus-icon">+</span>
      </button>
    </div>
  </div>

  <!-- Confirm Dialog -->
  <app-confirm-dialog *ngIf="showDialog" [colorScheme]="dialogColor" [title]="dialogTitle" [message]="dialogMessage"
    [confirmText]="dialogConfirmText" [cancelText]="dialogCancelText" (confirm)="confirmDialog()"
    (cancel)="cancelDialog()"></app-confirm-dialog>
</div>
